<section class="content-header">
    <h1 style="display: inline-block;">Visitor Queue</h1>
    <div class="pull-right">
        <p id="txt"></p>
        <p id="currentDate"></p>
    </div>
</section>

<section class="content">
    {{#if message}}
        <div class="alert alert-danger">{{message}}</div>
    {{/if}}

    <div class="row">
        <div class="col-md-12">
            <div class="box box-info">
                <!-- /.box-header -->
                <div class="box-body">
                    <div class="table-responsive">
                        <table class="table no-margin">
                            <thead>
                            <tr>
                                <th>Name</th>
                                <th>Doctor</th>
                                <th>Appointment Time</th>
                                <th>Check In Time</th>
                                <th>Status</th>
                            </tr>
                            </thead>
                            <tbody id="appointment-list">
                            {{#each patients}}
                                <tr onclick = "highlight()">
                                    <td>{{visitor}}</td>
                                    <td>{{doctor}}</td>
                                    <td>{{apptTime}}</td>
                                    <td>{{currentTime}}</td>
                                    <td>{{state}}</td>
                            {{/each}}
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <!-- /.table-responsive -->
                </div>
                <!-- /.box-body -->
                <div class="box-footer clearfix">
                    <a href="#" class="btn btn-sm btn-success btn-flat pull-right" onclick = "checkIn()">Check In</a>
                    <a href="#" class="btn btn-sm btn-warning btn-flat pull-right" onclick = "checkOut()">Check Out</a>
                    <a href="#" class="btn btn-sm btn-info btn-flat pull-right" onclick = "reschedule()">Reschedule</a>
                </div>
                <!-- /.box-footer -->
            </div>
        </div>
    </div>
</section>

<script src="/javascripts/visitor-list.js"></script>
<script src="/socket.io/socket.io.js"></script>
<script>
  var socket = io(window.location.origin);
  
  socket.on('checkin', function (data) {
    console.log(data);

    var apptList = document.getElementById('appointment-list');
    var appointment = document.createElement("tr");

    var visitorField = document.createElement("td");
    visitorField.appendChild( document.createTextNode(data.visitor) );
    appointment.appendChild(visitorField);

    var doctorField = document.createElement("td");
    doctorField.appendChild( document.createTextNode(data.doctor) );
    appointment.appendChild(doctorField);

    var apptTime = document.createElement("td");
    apptTime.appendChild( document.createTextNode(data.apptTime) );
    appointment.appendChild(apptTime);

    var time = new Date();
    var currTime = document.createElement("td");
    currTime.appendChild( document.createTextNode(data.currentTime) );
    appointment.appendChild(currTime);

    var status = document.createElement("td");
    status.appendChild( document.createTextNode(data.status) );
    appointment.appendChild(status);

    apptList.appendChild(appointment);
    
  });


</script>